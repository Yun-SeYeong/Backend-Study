# 시스템 설계(System Design)

### Single-Server Design

단순히 개인 프로젝트용으로 사용될시 괜찮은 방법이 될 수 있다. 트래픽이 적고 잠시 서버가 다운되어도 문제되지 않기 때문이다. 하지만 single point of failure이기 때문에 상업용으로는 사용할 수 없다.

#### 1. Seperating out the database

Database를 분리하여 서버와 Database가 동시에 장애가 발생하는 것을 막을 수 있다. 하지만 이 또한 데이터베이스가 장애가 발생해도 서비스가 동작하지 않고 서버가 장애가 발생해도 동작하지 않는다. 따라서 좋은 방법이라고 할 수는 없다.

#### 2. Vertical scaling

더 많은 트래픽을 감당하기 위해 Server의 사양을 업그레이드한다. 하지만 업그레이드에는 한계가 있다. 장점은 관리할 서버가 적어 유지보수가 편하다. 하지만 위와 똑같이 장애가 발생하면 해결될 때까지 서비스를 할 수 없다.

#### 3. Horizontal scaling

로드벨런서를 이용해 서버에 트래픽을 분산하고 단일 데이터베이스를 바라보도록 한다. 만약 서버한대가 죽어도 다른 서버로 트래픽을 분산하여 서비스가 항상 동작하도록 한다. 또한 무한 확장이 가능하다. 단점은 유지보수할 서버가 많다는점이다. 또한 이 시스템에서는 stateless 여야 한다. 왜냐하면 각 서버중 어떤 서버로 요청이 갈지 모르고 어떤 서버로 가더라도 서비스가 정상 동작해야하기 때문이다.

여기서 어떤 시스템이 정답이라고는 할 수 없다. 만약 규모가 작은 서비스를 만들때 horizontal scaling은 많은 서버를 관리해야하고 비용도 많이 들어가게 되어서 좋은 방법이 될수 없고 Youtube나 Google에서 vertical scaling은 치명적인 장애로 이어질 수 있다. 따라서 상황에 맞는 System-Design을 해야한다.

### Failover servers: Cold Standby

데이터베이스가 분리된 웹서비스에서 데이터베이스에 장애가 발생을 대비하기 위해 주기적으로 백업을 하고 장애가 발생하면 해당 내용을 다른 데이터베이스에 복구하여 서비스를 정성화 한다. 이 방법은 몇가지 단점이 있다. 첫번째는 다운 시간이 길어진다. 백업한 데이터를 다시 복구해야하기 때문에 데이터양에 따라 시간이 더 오래걸릴 수 도 있다. 두번째는 백업 이후 데이터는 복구할 수 없다. 주기적으로 수집하기때문에 수집 주기에 따라 일부 데이터손실을 용인해야한다. 한가지 장점은 저렴하다.

### Failover servers: Warm Standby

데이터베이스가 분리된 웹서비스에서 데이터베이스를 Replication하여 상시 백업하는 방식이다. 보통 데이터베이스마다의 자체 복사 메커니즘이 있어서 데이터베이스가 자동으로 관리한다. 데이터 손실이 일어날 수 있는 작은 여지는 있지만 주기적 백업보다는 훌륭한 접근법이다. 만약 장애가 발생하면 백업 데이터베이스로 리다이렉션한다 따라서 거의 데이터 손실이 없고 다운 시간도 짧다. 하지만 아직 수직 스케일링을 하고 있다. 트래픽이 증가하면 더 큰 데이터베이스로 변경하는 방법밖에 없다.

### Failover servers: Hot Standby

데이터베이스가 분리된 웹서비스에서 백엔드가 모든 데이터베이스에 쓰는 구조로 한다. 이 방법은 수평 스케일링에 가까워 졌다고 볼 수 있다. 장애가 발생하여도 데이터를 읽을 수 있고 트래픽의 분산도 할 수 있다.



### Horizontal Scaling of Databsases: Sharding

dfd
